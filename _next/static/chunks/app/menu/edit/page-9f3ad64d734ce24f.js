(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[264],{6715:function(e,n,r){Promise.resolve().then(r.bind(r,218))},9645:function(e,n,r){"use strict";r.d(n,{P:function(){return o}});var t=r(7437),a=r(6463),l=r(2265);let i=[{label:"メニュー検索",onClick:e=>e.push("/menu/select-genre")},{label:"Home",onClick:e=>e.push("/home")},{label:"戻る",onClick:e=>e.back()}],u=[{label:"メニュー検索",onClick:e=>e.push("/menu/select-genre")},{label:"Home",onClick:e=>e.push("/home")},{label:"MyPage",onClick:e=>e.push("/mypage")}];function o(e){var n;let r=null!==(n=e.buttons)&&void 0!==n?n:e.isHome?u:i;return(0,t.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,t.jsx)("main",{className:"flex flex-grow flex-shrink flex-col p-10 pt-14 overflow-y-scroll",children:(0,t.jsx)(l.Suspense,{children:e.children})}),0!=r.length&&(0,t.jsx)(c,{buttons:r,className:"flex-shrink-0"})]})}function c(e){let{className:n,buttons:r}=e,l=(0,a.useRouter)();return(0,t.jsx)("footer",{className:"w-full h-[20vw] bg-amber-600 flex flex-row ".concat(n),children:r.map(e=>{let{label:n,onClick:r}=e;return(0,t.jsx)("button",{className:"w-1 flex-grow h-full border-black border-2 border-l-0 first:border-l-2",onClick:()=>r(l),children:n},n)})})}},218:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return w}});var t=r(7437),a=r(6463),l=r(9645),i=r(7549),u=r(2472),o=r(4733);async function c(e,n,r,t){let a=await (0,o.y)(e,n);switch(r){case"lowLipid":return a.filter(e=>{let n=!!e.breakfast&&s(e.breakfast,t.breakfast),r=!!e.lunch&&s(e.lunch,t.lunch),a=!!e.dinner&&s(e.dinner,t.dinner);return n&&r&&a});case"healthy":return a.filter(e=>{let n=!!e.breakfast&&f(e.breakfast,t.breakfast),r=!!e.lunch&&f(e.lunch,t.lunch),a=!!e.dinner&&f(e.dinner,t.dinner);return n&&r&&a});case"lowCarbon":return a.filter(e=>{let n=!!e.breakfast&&d(e.breakfast,t.breakfast),r=!!e.lunch&&d(e.lunch,t.lunch),a=!!e.dinner&&d(e.dinner,t.dinner);return n&&r&&a});default:return a}}function s(e,n){return null==n.lipid?null!=e.lipid:null!=e.lipid&&e.lipid<.99*n.lipid}function f(e,n){return s(e,n)&&d(e,n)}function d(e,n){return null==n.carbon?null!=e.carbon:null!=e.carbon&&e.carbon<.99*n.carbon}var h=r(7858),m=r(3770),b=r(2265),g=r(4887),p=r(8260);function w(){return(0,t.jsx)(l.P,{children:(0,t.jsx)(k,{})})}function k(){let e=(0,a.useRouter)(),n=(0,a.useSearchParams)(),r=(0,m.v$)(),[l,o]=(0,b.useState)(!1),s=n.get("kind"),f=async n=>{let t;let a=(0,i.i5)(),l=(0,h.u)(a),f=l.find(e=>"breakfast"==e.mealKind),d=l.find(e=>"lunch"==e.mealKind),m=l.find(e=>"dinner"==e.mealKind),b={breakfast:f,lunch:d,dinner:m},w=f.menu[0].genre;(0,g.flushSync)(()=>o(!0)),await (0,p.v)();try{t=await c(w,r,n,{breakfast:f.menu[0],lunch:d.menu[0],dinner:m.menu[0]})}finally{o(!1)}let k=t[0];if(null==k){alert("適切な組み合わせが見つかりませんでした");return}if(null!=s)(0,u.J)(a,s,[{...k[s],ate:!1}],b[s].additionalEnergy);else for(let e of["breakfast","lunch","dinner"])(0,u.J)(a,e,[{...k[e],ate:!1}],b[e].additionalEnergy);e.back()};return l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"text-xl",children:null==s?"メニュー改善":"".concat(x[s],"のメニュー改善")}),(0,t.jsx)("hr",{className:"border-amber-700"}),(0,t.jsx)("p",{children:"検索中..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h3",{className:"text-xl",children:null==s?"メニュー改善":"".concat(x[s],"のメニュー改善")}),(0,t.jsx)("hr",{className:"border-amber-700 mb-2"}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)("button",{className:"border-2 border-black w-40",onClick:()=>f("lowLipid"),children:"低脂質"}),(0,t.jsx)("button",{className:"border-2 border-black w-40",onClick:()=>f("healthy"),children:"ヘルシー"}),(0,t.jsx)("button",{className:"border-2 border-black w-40",onClick:()=>f("lowCarbon"),children:"低炭水化物"})]})]})}let x={breakfast:"朝食",lunch:"昼食",dinner:"夕食"}},7858:function(e,n,r){"use strict";function t(e){return JSON.parse(localStorage.getItem("eatenData")||"[]").filter(n=>n.date===e)}r.d(n,{u:function(){return t}})},2472:function(e,n,r){"use strict";function t(e,n,r,t){let a=JSON.parse(localStorage.getItem("eatenData")||"[]"),l=a.findIndex(r=>r.date===e&&r.mealKind===n);-1!==l&&a.splice(l,1),a.push({date:e,mealKind:n,additionalEnergy:t,menu:r});let i=JSON.stringify(a);return localStorage.setItem("eatenData",i),!0}r.d(n,{J:function(){return t}})},3770:function(e,n,r){"use strict";r.d(n,{Hb:function(){return s},uN:function(){return c},v$:function(){return f}});var t=r(2265),a=r(7200),l=r(6463);r(5592);var i=r(7858),u=r(7549);function o(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[r,a]=(0,t.useState)();if(void 0!==r&&n.length==r.dependencies.length&&n.every((e,n)=>Object.is(e,r.dependencies[n])))return r.value;let l=e();return a({value:l,dependencies:n}),l}function c(){return s((0,u.i5)())}function s(e){return o(()=>(0,i.u)(e),[e])}function f(){let e=(0,l.useRouter)();return o(()=>{let n=(0,a.i)();if(null!=n)return n;throw setTimeout(()=>{e.replace("/setup/enter")},0),new Promise(()=>{})})}},5113:function(e,n,r){"use strict";function t(e){return function(e){let{sex:n,height:r,weight:t,birthday:a}=e,l=function(e){let n=new Date(e),r=new Date,t=r.getFullYear()-n.getFullYear(),a=r.getMonth()-n.getMonth();return(a<0||0===a&&r.getDate()<n.getDate())&&t--,t}(a);return"man"===n?88.362+13.397*t+4.799*r-5.677*l:447.593+9.247*t+3.098*r-4.33*l}(e)*function(e){switch(e){case 1:return 1.2;case 2:return 1.375;case 3:return 1.55;case 4:return 1.725;case 5:return 1.9;default:throw Error("Invalid exercise load")}}(e.load)}r.d(n,{Rt:function(){return t}})},4733:function(e,n,r){"use strict";r.d(n,{y:function(){return l}});var t=r(5113);async function a(e,n){try{let r;if("mockMenus"in globalThis)return globalThis.mockMenus;if(!(r="matsuya"==n||"sevenEleven"==n?await fetch("/api/menus/".concat(n,".json")):await fetch("/api/menus.json?genre=".concat(e,"&store=").concat(n))).ok)throw Error("Error fetching menu info: ".concat(r.statusText));let t=await r.json();for(let e of t)null==e.store&&(e.store=[n]);return t}catch(e){throw console.error("Failed to retrieve menu information",e),e}}async function l(e,n){let r=(0,t.Rt)(n),a=await i(e,n,"breakfast"),l=await i(e,n,"lunch"),u=await i(e,n,"dinner"),o=[];return a.forEach(e=>{l.forEach(r=>{u.forEach(t=>{if(e.name!==r.name&&e.name!==t.name&&r.name!==t.name){let a=e.energy+r.energy+t.energy,l=e.price+r.price+t.price;l<=n.price&&o.push({breakfast:e,lunch:r,dinner:t,totalCalories:a,totalPrice:l})}})})}),o.sort((e,n)=>Math.abs(e.totalCalories-r)-Math.abs(n.totalCalories-r)),o}async function i(e,n,r){let l=await Promise.all(n.stores.map(n=>a(e,n))).then(e=>e.flatMap(e=>e)),i=(0,t.Rt)(n),u="breakfast"===r?3*n.price/10:4*n.price/10,o="breakfast"===r?3*i/10:4*i/10;return l.filter(r=>{let t=r.genre.includes(e),a=.8*o<=r.energy&&r.energy<=1.1*o,l=!r.allergens.some(e=>n.allergens.includes(e)),i=r.price<=u,c=r.store.some(e=>n.stores.includes(e));return t&&a&&l&&i&&c})}},7200:function(e,n,r){"use strict";r.d(n,{A:function(){return a},i:function(){return l}});let t="userDatabase";function a(e){!function(e){if(e.height<=0)throw Error("身長は半角数字にしてください.");if(e.weight<=0)throw Error("体重は半角数字にしてください.");if(e.load<1||e.load>5)throw Error("運動量は1から5の半角数字にしてください.");if(!Array.isArray(e.stores)||0===e.stores.length)throw Error("飲食店を選択してください.");if(!Array.isArray(e.allergens))throw Error("アレルギーを選択してください.");if(e.price<0)throw Error("価格は半角数字にしてください.")}(e),localStorage.setItem(t,JSON.stringify(e))}function l(){return function(){let e=localStorage.getItem(t);return e?JSON.parse(e):null}()}},7549:function(e,n,r){"use strict";function t(){return a(new Date)}function a(e){return"".concat(e.getFullYear(),"-").concat((e.getMonth()+1).toString(10).padStart(2,"0"),"-").concat(e.getDate().toString(10).padStart(2,"0"))}function l(e){let[n,r,t]=e.split("-").map(Number);return[n,r,t]}r.d(n,{RD:function(){return l},bW:function(){return a},i5:function(){return t}})},8260:function(e,n,r){"use strict";async function t(){await new Promise(e=>requestAnimationFrame(e)),await new Promise(e=>requestAnimationFrame(e))}r.d(n,{v:function(){return t}})},6463:function(e,n,r){"use strict";var t=r(1169);r.o(t,"useRouter")&&r.d(n,{useRouter:function(){return t.useRouter}}),r.o(t,"useSearchParams")&&r.d(n,{useSearchParams:function(){return t.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6715)}),_N_E=e.O()}]);